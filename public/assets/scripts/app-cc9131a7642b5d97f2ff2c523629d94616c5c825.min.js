var App;(function(App){var Main=(function(){function Main(){this.CheckVoteLinks();this.ActivateVoteLinks();this.ActivateCloseLinks();this.ActivateShowLinks();this.ActivateMethodLinks();this.ActivateMessageLinks();this.ActivateModalLinks();this.ScrollUp();this.ScrollPrev();this.ScrollNext();}
Main.prototype.ActivateCloseLinks=function(){Dom.On(".js-close","click",function(){var selector=this.getAttribute("data-close");var element=Dom.First(selector);element.parentNode.removeChild(element);localStorage.setItem("techfront_"+selector+"_close","true");});};Main.prototype.ActivateMethodLinks=function(){Dom.On("a[method='post'], a[method='delete']","click",function(e){if(this.getAttribute("method")==="delete"){if(!confirm("Are you sure you want to delete this item, this action cannot be undone?")){return false;}}
var meta=Dom.First("meta[name='authenticity_token']");if(meta===undefined){e.preventDefault();return false;}
var token=meta.getAttribute("content");var url=this.getAttribute("href");var redirect=this.getAttribute("data-redirect");var data="authenticity_token="+token;Dom.Post(url,data,function(){if(redirect!==null){window.location=redirect;}
else{window.location.reload();}},function(){});e.preventDefault();return false;});Dom.On("a[method='back']","click",function(e){history.back();e.preventDefault();return false;});};Main.prototype.ActivateShowLinks=function(){Dom.On(".js-show","click",function(e){var selector=this.getAttribute("data-show");Dom.Each(selector,function(element,i){if(!element.className.match(/hidden/gi)){element.className=element.className+"--hidden";}
else{element.className=element.className.replace(/--hidden/gi,"");}});e.preventDefault();return false;});};Main.prototype.CheckVoteLinks=function(){Dom.Each("[data-vote]",function(element,i){var vote=element.getAttribute("data-vote");var voteID=element.getAttribute("data-vote-id");if(localStorage.getItem("techfront_"+voteID+"_vote")===vote){var parentElement=element.parentNode;if(!parentElement.className.match(/notvoted/gi)){parentElement.className=element.className+"--notvoted";}
else{parentElement.className=parentElement.className.replace(/--notvoted/gi,"");}}});};Main.prototype.ActivateVoteLinks=function(){Dom.On(".js-vote","click",function(){var vote=this.getAttribute("data-vote");var voteID=this.getAttribute("data-vote-id");localStorage.setItem("techfront_"+voteID+"_vote",vote);});};Main.prototype.SmoothScroll=function(offset,duration,e){e.preventDefault();var cosParameter=(window.scrollY-offset)/2,scrollCount=0,oldTimestamp=performance.now();var requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;function step(newTimestamp){scrollCount+=Math.PI/(duration/(newTimestamp-oldTimestamp));if(scrollCount>=Math.PI)
return;window.scrollTo(0,Math.round(offset+cosParameter+cosParameter*Math.cos(scrollCount)));oldTimestamp=newTimestamp;requestAnimationFrame(step);}
requestAnimationFrame(step);};Main.prototype.ScrollUp=function(){var _this=this;Dom.On(".js-scroll-up","click",function(e){_this.SmoothScroll(0,1000,e);});};Main.prototype.ScrollNext=function(){var _this=this;Dom.On(".js-control-next","click",function(e){var offset=window.scrollY+500;_this.SmoothScroll(offset,600,e);});};Main.prototype.ScrollPrev=function(){var _this=this;Dom.On(".js-control-prev","click",function(e){var offset=window.scrollY-500;_this.SmoothScroll(offset,600,e);});};Main.prototype.ActivateMessageLinks=function(){Dom.On(".js-message-close","click",function(){var selector=this.getAttribute("data-message");var element=Dom.First(selector);element.parentNode.removeChild(element);});};Main.prototype.ActivateModalLinks=function(){Dom.On(".js-modal-show","click",function(e){Dom.Each(".modal",function(element,i){element.classList.add("modal--hidden");});var selector=this.getAttribute("data-modal");Dom.Each(selector,function(element,i){element.classList.remove("modal--hidden");});e.preventDefault();return false;});Dom.On(".js-modal-hide","click",function(e){var selector=this.getAttribute("data-modal");Dom.Each(selector,function(element,i){element.classList.add("modal--hidden");});e.preventDefault();return false;});};return Main;}());App.Main=Main;})(App||(App={}));var Dropdown;(function(Dropdown){var Main=(function(){function Main(){this.ActivateToggleLinks();}
Main.prototype.CloseByOutsideClick=function(element){Dom.One("html","click",function(e){element.classList.remove("dropdown__menu--show");});};Main.prototype.ActivateToggleLinks=function(){var _this=this;Dom.On(".js-dropdown","click",function(e){var target=e.currentTarget;var selector=target.getAttribute("data-menu");var menu=Dom.First(selector);menu.classList.toggle("dropdown__menu--show");e.preventDefault();if(menu.classList.contains("dropdown__menu--show")!==false){_this.CloseByOutsideClick(menu);e.stopPropagation();}});};return Main;}());Dropdown.Main=Main;})(Dropdown||(Dropdown={}));var WidgetFixed;(function(WidgetFixed){var Main=(function(){function Main(){var _this=this;this.fixedEl=Dom.First(".js-widget--fixed");this.aboutEl=Dom.First(".js-widget--fixed-about");this.scrollUpEl=Dom.First(".js-scroll-up");if(this.aboutEl!==undefined){this.AboutCheckClose();}
var body=document.body;var html=document.documentElement;window.onload=window.onscroll=function(){_this.pageHeight=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);_this.Sticky();_this.ScrollUpFadeIn();if(_this.aboutEl!==undefined){_this.AboutFadeOut();}};}
Main.prototype.Sticky=function(){var scroll=window.pageYOffset||document.documentElement.scrollTop;if((this.pageHeight-scroll-document.documentElement.clientHeight)<=150){this.fixedEl.style.bottom="38px";this.fixedEl.style.position="absolute";}
else{this.fixedEl.style.bottom="";this.fixedEl.style.position="";}};Main.prototype.ScrollUpFadeIn=function(){if(window.pageYOffset<=300){this.scrollUpEl.style.opacity="0.3";this.scrollUpEl.style.pointerEvents="none";}
else{this.scrollUpEl.style.opacity=((window.pageYOffset)/900).toString();this.scrollUpEl.style.pointerEvents="";}};Main.prototype.AboutFadeOut=function(){if(this.aboutIsClose!==true){if(window.pageYOffset<=520){this.aboutEl.style.opacity=((500-window.pageYOffset)/500).toString();this.aboutEl.style.height="120px";}
else{this.aboutEl.style.height="0";}}};Main.prototype.AboutCheckClose=function(){if(localStorage.getItem("techfront_.js-widget--fixed-about_close")==="true"){this.aboutEl.parentNode.removeChild(this.aboutEl);this.aboutIsClose=true;}
else{this.aboutEl.style.display="";this.aboutIsClose=false;}};return Main;}());WidgetFixed.Main=Main;})(WidgetFixed||(WidgetFixed={}));var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value);}).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments)).next());});};var __generator=(this&&this.__generator)||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t;return{next:verb(0),"throw":verb(1),"return":verb(2)};function verb(n){return function(v){return step([n,v]);};}
function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=y[op[0]&2?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[0,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}
if(op[0]===3&&(!t||(op[1]>t[0]&&op[1]<t[3]))){_.label=op[1];break;}
if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}
if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}
if(t[2])_.ops.pop();_.trys.pop();continue;}
op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}
if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};var ComponentTopic;(function(ComponentTopic){var Main=(function(){function Main(){var _this=this;this.notifier=new Notifier["default"]({theme:"techfront",position:"top-right"});window.addEventListener("DOMContentLoaded",function(){_this.SetBlockContainerHeight();});window.addEventListener("resize",function(){_this.SetBlockContainerHeight();});this.HandleFavorite();}
Main.prototype.SetBlockContainerHeight=function(){var containerElement=Dom.First(".js-topic-index--block-container");if(containerElement!==undefined||typeof containerElement!=="undefined"){if(containerElement.querySelector(".block")!==null){containerElement.style.height=(containerElement.firstElementChild.clientHeight-10).toString()+"px";Dom.On(".js-topic-index--block-container .js-close","click",function(){containerElement.style.height="";});}}};Main.prototype.FetchCreateFavorite=function(userId,topicId){return __awaiter(this,void 0,void 0,function(){var response;return __generator(this,function(_a){switch(_a.label){case 0:return[4,window.fetch("/api/v3/post/user/favorite",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:"id_user="+userId+"&id_topic="+topicId,credentials:"same-origin"})];case 1:response=_a.sent();return[4,response.json()];case 2:return[2,_a.sent()];}});});};Main.prototype.FetchDestroyFavorite=function(userId,topicId){return __awaiter(this,void 0,void 0,function(){var response;return __generator(this,function(_a){switch(_a.label){case 0:return[4,window.fetch("/api/v3/post/user/unfavorite",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:"id_user="+userId+"&id_topic="+topicId,credentials:"same-origin"})];case 1:response=_a.sent();return[4,response.json()];case 2:return[2,_a.sent()];}});});};Main.prototype.ToggleFavoriteLink=function(element,action){if(action==="create"){element.innerHTML="<i class=\"icon-bookmark\"></i> Удалить из избранного";element.className="js-topic--favorite topic__meta-unfavorite";element.setAttribute("data-action","destroy");}
else if(action==="destroy"){element.innerHTML="<i class=\"icon-bookmark\"></i> Прочитать позже";element.className="js-topic--favorite topic__meta-favorite";element.setAttribute("data-action","create");}};Main.prototype.HandleFavorite=function(){var _this=this;Dom.On(".js-topic--favorite","click",function(e){var target=e.target;var action=target.getAttribute("data-action");var userId=target.getAttribute("data-id-user");var topicId=target.getAttribute("data-id-topic");var response;if(action==="create"){response=_this.FetchCreateFavorite(userId,topicId);}
else if(action==="destroy"){response=_this.FetchDestroyFavorite(userId,topicId);}
response.then(function(data){if(typeof data._code!=="undefined"){_this.notifier.post(data._meta._notice,{delay:6000,type:"error"});}
else{_this.ToggleFavoriteLink(target,action);_this.notifier.post(data._meta._notice,{delay:6000,type:"success"});}}).catch(function(reason){console.log(reason.message);});e.preventDefault();});};return Main;}());ComponentTopic.Main=Main;})(ComponentTopic||(ComponentTopic={}));var ComponentUser;(function(ComponentUser){var Main=(function(){function Main(){this.activateMessage=Dom.First(".js-message--user-activate");if(this.activateMessage!==undefined){this.notifier=new Notifier["default"]({theme:"techfront",position:"top-right"});this.HandleActivate();}
this.ContactFieldAdd();this.ContactFieldRemove();this.ContactFieldChangeType();}
Main.prototype.HandleActivate=function(){var _this=this;Dom.On(".js-message--user-activate-send","click",function(e){var target=e.target;var id=target.getAttribute("data-user-id");window.fetch("/api/v3/post/user/activate",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:"id_user="+id,credentials:"same-origin"}).then(function(response){return response.json();}).then(function(response){if(typeof response._code!=="undefined"){_this.notifier.post(response._meta._notice,{delay:6000,type:"error"});}
else{_this.notifier.post(response._meta._notice,{delay:6000,type:"success"});}});e.preventDefault();});};Main.prototype.ContactFieldChangeType=function(){Dom.On(".js-user--contact-field-change-type","change",function(e){var select=e.target;var selectValue=select.options[select.selectedIndex].value;var fieldId=select.getAttribute("data-field-id");var field=document.getElementById(fieldId);field.querySelector(".input").setAttribute("name",selectValue);});};Main.prototype.ContactFieldRemove=function(){Dom.On(".js-user--contact-fields-remove","click",function(e){var container=document.getElementById("user-contact-fields-list");var fieldId=this.getAttribute("data-field-id");var field=document.getElementById(fieldId);field.parentNode.removeChild(field);if(container.childElementCount<8){var cfaTarget=document.querySelector(".js-user--contact-fields-add");cfaTarget.classList.remove("user__contact-fields-add--lock");}
e.preventDefault();});};Main.prototype.ContactFieldAdd=function(){var _this=this;Dom.On(".js-user--contact-fields-add","click",function(e){var target=e.target;var container=document.getElementById("user-contact-fields-list");if(target.classList.contains("user__contact-fields-add--lock")){e.preventDefault();return;}
var fieldId="user-contact-field-id-"+container.childElementCount;var field=document.createElement("div");field.id=fieldId;field.classList.add("user__contact-fields-item");field.innerHTML="\n                                 <select class=\"js-user--contact-field-change-type select\" data-field-id=\""+fieldId+"\">\n                                    <option value=\"user_contact_email\" selected=\"selected\">\u041F\u043E\u0447\u0442\u0430</option>\n                                    <option value=\"user_contact_phone\">\u0422\u0435\u043B\u0435\u0444\u043E\u043D</option>      \n                                    <option value=\"user_contact_website\">\u0421\u0430\u0439\u0442</option>\n                                     <option value=\"user_contact_github\">Github</option>\n                                    <option value=\"user_contact_telegram\">Telegram</option>\n                                    <option value=\"user_contact_whatsapp\">WhatsApp</option>\n                                    <option value=\"user_contact_viber\">Viber</option>\n                                    <option value=\"user_contact_skype\">Skype</option>\n                                    <option value=\"user_contact_vkontakte\">\u0412\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u0435</option>\n                                    <option value=\"user_contact_twitter\">Twitter</option>\n                                    <option value=\"user_contact_youtube\">YouTube</option>\n                                    <option value=\"user_contact_facebook\">Facebook</option>\n                                </select>\n                                <input type=\"text\" class=\"input\" name=\"user_contact_email\" value=\"\">\n                                <a href=\"#\" class=\"js-user--contact-fields-remove user__contact-fields-remove\" data-field-id=\""+fieldId+"\"><i class=\"icon-trash-empty\"></i></a>";container.appendChild(field);_this.ContactFieldChangeType();_this.ContactFieldRemove();if(container.childElementCount>=8){target.classList.add("user__contact-fields-add--lock");}
e.preventDefault();});};return Main;}());ComponentUser.Main=Main;})(ComponentUser||(ComponentUser={}));var WidgetShare;(function(WidgetShare){var Main=(function(){function Main(){this.ActivateShareLinks();}
Main.prototype.ActivateShareLinks=function(){Dom.On(".js-widget--share","click",function(e){var width=650,height=450;e.preventDefault();window.open(this.href,"Share Dialog","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,width="+width+",height="+height+",top="+(screen.height/2-height/2)+",left="+(screen.width/2-width/2));});};return Main;}());WidgetShare.Main=Main;})(WidgetShare||(WidgetShare={}));var WidgetSubscribe;(function(WidgetSubscribe){var Main=(function(){function Main(){this.element=Dom.First(".js-widget--subscribe");if(this.element!==undefined){this.notifier=new Notifier["default"]({theme:"techfront",position:"top-right"});this.HandleSubmit();this.CheckClose();}}
Main.prototype.HandleSubmit=function(){var _this=this;Dom.On(".js-widget--subscribe-form","submit",function(e){e.preventDefault();var form=e.target;_this.FetchResponse(form);});};Main.prototype.FetchResponse=function(form){var _this=this;var data=getFormData(form,{trim:true});var params="";for(var i in data){params+=encodeURIComponent(i)+"="+encodeURIComponent(data[i])+"&";}
window.fetch("/api/v3/post/user/subscribe",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:params}).then(function(response){return response.json();}).then(function(response){if(typeof response._code!=="undefined"){_this.notifier.post(response._meta._notice,{delay:6000,type:"error"});}
else{_this.notifier.post(response._meta._notice,{delay:6000,type:"success"});}});};Main.prototype.CheckClose=function(){if(localStorage.getItem("techfront_.js-widget--subscribe_close")==="true"){this.element.parentNode.removeChild(this.element);}
else{this.element.style.display="";}};return Main;}());WidgetSubscribe.Main=Main;})(WidgetSubscribe||(WidgetSubscribe={}));Dom.Ready(function(){new App.Main();new Dropdown.Main();new ComponentTopic.Main();new ComponentUser.Main();new WidgetFixed.Main();new WidgetShare.Main();new WidgetSubscribe.Main();});